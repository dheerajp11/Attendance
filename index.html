
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attendance Calendar</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 10px;
      background: #f2f2f2;
    }
    h2 {
      text-align: center;
    }
    .calendar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .month {
      background: white;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .month h3 {
      text-align: center;
    }
    .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      font-size: 12px;
    }
    .day {
      padding: 10px;
      background: #eee;
      text-align: center;
      border-radius: 6px;
      cursor: pointer;
    }
    .sunday {
      color: red;
    }
    .P {
      background: green;
      color: white;
    }
    .A {
      background: red;
      color: white;
    }
    .L {
      background: orange;
      color: white;
    }
    .H {
      background: #2196f3;
      color: white;
    }
    .Half {
      background: purple;
      color: white;
    }
    #locationStatus {
      text-align: center;
      margin-bottom: 10px;
      font-size: 14px;
      color: green;
    }
  </style>
</head>
<body>
  <h2>üìÖ Attendance Calendar (2024‚Äì2025)</h2>
  <div id="locationStatus">üìç Checking location...</div>
  <div class="calendar" id="calendar"></div>

<script>
const allowedLat = 26.8262645;
const allowedLng = 80.9260447;
const MAX_DISTANCE_KM = 0.15;
let isInLocation = false;

function toRad(value) {
  return (value * Math.PI) / 180;
}

function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(lat1)) *
      Math.cos(toRad(lat2)) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

function checkLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        const dist = getDistance(lat, lng, allowedLat, allowedLng);
        isInLocation = dist <= MAX_DISTANCE_KM;
        document.getElementById("locationStatus").textContent = isInLocation
          ? "‚úÖ Location Verified"
          : "‚ùå You are out of location range.";
      },
      (err) => {
        document.getElementById("locationStatus").textContent = "‚ùå Location access denied.";
      }
    );
  } else {
    document.getElementById("locationStatus").textContent = "‚ùå Geolocation not supported.";
  }
}

function isWithinTimeWindow() {
  const now = new Date();
  const hour = now.getHours();
  const minute = now.getMinutes();
  const total = hour * 60 + minute;
  return total >= 540 && total <= 580; // 9:00‚Äì9:40 AM
}

function generateCalendar(year) {
  const calendar = document.getElementById("calendar");
  for (let month = 0; month < 12; month++) {
    const monthDiv = document.createElement("div");
    monthDiv.className = "month";
    const monthName = new Date(year, month).toLocaleString("default", { month: "long" });
    monthDiv.innerHTML = `<h3>${monthName} ${year}</h3>`;
    const daysDiv = document.createElement("div");
    daysDiv.className = "days";
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    for (let d = 1; d <= daysInMonth; d++) {
      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
      const dateObj = new Date(dateStr);
      const dayDiv = document.createElement("div");
      dayDiv.className = "day";
      if (dateObj.getDay() === 0) dayDiv.classList.add("sunday");
      const status = localStorage.getItem("att_" + dateStr);
      if (status) dayDiv.classList.add(status);
      dayDiv.textContent = d;
      dayDiv.onclick = () => handleAttendanceClick(dateStr, dayDiv);
      daysDiv.appendChild(dayDiv);
    }
    monthDiv.appendChild(daysDiv);
    calendar.appendChild(monthDiv);
  }
}

function handleAttendanceClick(date, el) {
  if (!isInLocation) return alert("‚ùå ‡§Ü‡§™ location ‡§ï‡•á ‡§¨‡§æ‡§π‡§∞ ‡§π‡•à‡§Ç");
  if (!isWithinTimeWindow()) return alert("‚ùå ‡§Ö‡§ü‡•á‡§Ç‡§°‡•á‡§Ç‡§∏ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø 9:00 ‡§∏‡•á 9:40 AM ‡§π‡•à");
  if (localStorage.getItem("att_" + date)) return alert("‚úÖ ‡§á‡§∏ ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ï‡•Ä ‡§Ö‡§ü‡•á‡§Ç‡§°‡•á‡§Ç‡§∏ ‡§™‡§π‡§≤‡•á ‡§π‡•Ä ‡§≤‡§ó ‡§ö‡•Å‡§ï‡•Ä ‡§π‡•à");
  const status = prompt("Enter status (P, A, L, Half, H):").toUpperCase();
  if (!["P", "A", "L", "H", "HALF"].includes(status)) return alert("‚ùå Invalid status");
  localStorage.setItem("att_" + date, status);
  el.classList.add(status);
}

checkLocation();
generateCalendar(2024);
generateCalendar(2025);
</script>
</body>
</html>
